<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Projects - Project Manager | Resource Management System</title>

  <link rel="stylesheet" href="main.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    .project-tabs { display:flex; gap:10px; margin-bottom:25px; border-bottom:2px solid var(--medium-gray); }
    .tab-btn { padding:12px 24px; background:none; border:none; border-bottom:3px solid transparent; cursor:pointer; font-size:14px; font-weight:500; color:var(--text-gray); transition:all .3s ease; }
    .tab-btn:hover { color:var(--primary-black); }
    .tab-btn.active { color:var(--primary-black); border-bottom-color:var(--primary-black); }
    .tab-content { display:none; }
    .tab-content.active { display:block; }

    .project-card { background:var(--white); border-radius:var(--border-radius); padding:20px; margin-bottom:20px; box-shadow:var(--shadow); transition:transform .3s ease, box-shadow .3s ease; }
    .project-card:hover { transform:translateY(-2px); box-shadow:var(--shadow-hover); }
    .project-header { display:flex; justify-content:space-between; align-items:start; gap:12px; margin-bottom:15px; }
    .project-title { font-size:18px; font-weight:600; color:var(--primary-black); margin-bottom:5px; }
    .project-meta { display:flex; gap:20px; font-size:13px; color:var(--text-gray); margin-bottom:15px; flex-wrap:wrap; }
    .project-meta-item { display:flex; align-items:center; gap:6px; }

    .resource-progress { margin-top:15px; }
    .progress-label { display:flex; justify-content:space-between; margin-bottom:8px; font-size:13px; color:var(--text-gray); }
    .progress-bar-container { height:8px; background-color:var(--light-gray); border-radius:10px; overflow:hidden; }
    .progress-bar { height:100%; background-color:var(--accent-blue); transition:width .3s ease; }
    .progress-bar.full { background-color:var(--success-green); }
    .progress-bar.partial { background-color:var(--warning-orange); }

    .card-actions { display:flex; gap:8px; flex-wrap:wrap; }
    .btn-ghost { background:transparent; border:1px solid var(--medium-gray); color:var(--primary-black); }
    .btn-ghost:hover { background:#eee; }

    .history { margin-top:14px; border-top:1px solid var(--light-gray); padding-top:12px; }
    .history h4 { font-size:14px; margin-bottom:8px; color:var(--text-gray); }
    .history ul { list-style:none; margin:0; padding:0; display:grid; gap:6px; }
    .history li { font-size:13px; color:var(--text-gray); display:flex; gap:8px; align-items:center; }
    .history time { font-variant-numeric: tabular-nums; color:#999; }

    /* Modal baseline for click-through */
    .modal-overlay { display:none; pointer-events:none; }
    .modal-overlay.active { display:flex; pointer-events:auto; }

    /* compact inline resource row (used by both modals) */
    .resource-row { display:flex; gap:10px; margin-bottom:10px; align-items:end; }
    .resource-row > div { flex:1; }
    .resource-row > div.skills { flex:2; }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>RMS - PM</h2>
        <p>John Doe</p>
      </div>

      <nav class="sidebar-menu">
        <a href="dashboard.html" class="menu-item" data-force-nav>
          <i class="fas fa-gauge"></i><span>Dashboard</span>
        </a>
        <a href="my-projects.html" class="menu-item active" data-force-nav>
          <i class="fas fa-project-diagram"></i><span>My Projects</span>
        </a>
        <a href="profile.html" class="menu-item" data-force-nav>
          <i class="fas fa-user"></i><span>Profile</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <button class="logout-btn" onclick="handleLogout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="content-header">
        <h1>My Projects</h1>
        <p class="breadcrumb">Home / My Projects</p>
      </div>

      <div class="content-card">
        <div class="card-header">
          <h2>Project Management</h2>
          <button class="btn btn-primary" onclick="openNewProjectModal()">
            <i class="fas fa-plus"></i> New Project
          </button>
        </div>

        <!-- Project Tabs -->
        <div class="project-tabs">
          <button class="tab-btn active" onclick="switchTab(this,'all')">All Projects (<span id="count-all">0</span>)</button>
          <button class="tab-btn" onclick="switchTab(this,'active')">Active (<span id="count-active">0</span>)</button>
          <button class="tab-btn" onclick="switchTab(this,'pending')">Pending (<span id="count-pending">0</span>)</button>
          <button class="tab-btn" onclick="switchTab(this,'completed')">Completed (<span id="count-completed">0</span>)</button>
        </div>

        <!-- Tabs -->
        <div id="all-tab" class="tab-content active"></div>
        <div id="active-tab" class="tab-content"></div>
        <div id="pending-tab" class="tab-content"></div>
        <div id="completed-tab" class="tab-content"></div>
      </div>
    </main>
  </div>

  <!-- New Project Modal (dynamic resource rows) -->
  <div class="modal-overlay" id="newProjectModal">
    <div class="modal" style="max-width: 800px;">
      <div class="modal-header">
        <h3>Request New Project Resources</h3>
        <button class="modal-close" onclick="closeNewProjectModal()">&times;</button>
      </div>
      <form id="newProjectForm" onsubmit="submitNewProject(event)">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Project Name *</label>
            <input type="text" class="form-control" name="project_name" required />
          </div>

          <div class="form-group">
            <label class="form-label">Start Date *</label>
            <input type="date" class="form-control" name="start_date" required />
          </div>

          <div class="form-group">
            <label class="form-label">Expected Duration *</label>
            <input type="text" class="form-control" name="duration" placeholder="e.g., 3 months, 6 weeks" required />
          </div>

          <div class="form-group">
            <label class="form-label">Priority *</label>
            <select class="form-control" name="priority" required>
              <option value="">Select Priority</option>
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
              <option value="Critical">Critical</option>
            </select>
          </div>

          <!-- Dynamic Resource Requirements -->
          <div class="form-group">
            <label class="form-label">Resource Requirements</label>
            <div id="resourceContainer">
              <!-- one default row -->
              <div class="resource-row">
                <div>
                  <label class="form-label">Resource Type</label>
                  <input type="text" class="form-control" name="resource_type[]" placeholder="e.g., Developer" required>
                </div>
                <div>
                  <label class="form-label"># Needed</label>
                  <input type="number" class="form-control" name="resource_count[]" min="1" value="1" required>
                </div>
                <div class="skills">
                  <label class="form-label">Required Skills</label>
                  <input type="text" class="form-control" name="required_skills[]" placeholder="e.g., React, PHP" required>
                </div>
                <button type="button" class="btn btn-danger btn-sm" onclick="removeResourceRow(this)" title="Remove row" style="height:44px;">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <button type="button" class="btn btn-secondary btn-sm mt-1" onclick="addResourceRow()">
              <i class="fas fa-plus"></i> Add Another
            </button>
          </div>

          <div class="form-group">
            <label class="form-label">Additional Notes</label>
            <textarea class="form-control" name="notes" rows="4" placeholder="Any additional information about the project..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeNewProjectModal()">Cancel</button>
          <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Submit Request</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Request Resources Modal (now dynamic rows) -->
  <div class="modal-overlay" id="requestModal">
    <div class="modal" style="max-width: 740px;">
      <div class="modal-header">
        <h3>Request Additional Resources</h3>
        <button class="modal-close" onclick="closeRequestModal()">&times;</button>
      </div>
      <form class="modal-body" id="requestForm" onsubmit="submitResourceRequest(event)">
        <p id="reqProjectName" style="margin-bottom:14px; color:var(--text-gray);"></p>

        <!-- Dynamic rows for additions -->
        <div class="form-group">
          <label class="form-label">People & Skills Needed</label>
          <div id="reqResourceContainer">
            <div class="resource-row">
              <div>
                <label class="form-label">Resource Type</label>
                <input type="text" class="form-control" name="req_resource_type[]" placeholder="e.g., FE Developer" required>
              </div>
              <div>
                <label class="form-label">People to Add</label>
                <input type="number" class="form-control" name="req_resource_count[]" min="1" value="1" required>
              </div>
              <div class="skills">
                <label class="form-label">Skills Required</label>
                <input type="text" class="form-control" name="req_required_skills[]" placeholder="e.g., React, Redux" required>
              </div>
              <button type="button" class="btn btn-danger btn-sm" onclick="removeReqRow(this)" title="Remove row" style="height:44px;">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          <button type="button" class="btn btn-secondary btn-sm mt-1" onclick="addReqRow()">
            <i class="fas fa-plus"></i> Add Another
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">Reason / Notes (optional)</label>
          <textarea class="form-control" name="reason" rows="3" placeholder="Any context to help HR approve the request"></textarea>
        </div>
      </form>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeRequestModal()">Cancel</button>
        <button class="btn btn-primary" form="requestForm" type="submit">Submit Request</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="../project-manager/assets/js/my-projects.js"></script>
</body>
</html>
